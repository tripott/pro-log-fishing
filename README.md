# pro-log-fishing

## Getting Started / Environment Setup

- install [node](https://nodejs.org/)
- install the [now](https://zeit.co/docs/getting-started/installing-now#installing-from-npm) CLI
- [yarn](https://yarnpkg.com/en/docs/install) (optional)
- Clone repo and install dependencies

  ```
  $ git clone https://github.com/tripott/pro-log-fishing.git
  $ cd pro-log-fishing
  $ yarn (or npm install)
  ```

### Setting up CouchDB on Cloudant

**pro-log-fishing** synchronizes an in-browser PouchDB database with a hosted CouchDB in Cloudant, a fully-managed NoSQL database-as-a-service (DBaaS).

- Sign up/Sign in to [Cloudant](https://cloudant.com/).
- Within the Cloudant dashboard, create a database named **fishing**
- Navigate to new **fishing** database.
- Within the database, Select the **Permissions** tab.
- Generate an API key and password.

> IMPORTANT:  Please make a note of the password and keep it safe. For security reasons, Cloudant does not store it for you to retrieve in the future.  Keep your password a secret!  Do not deploy password to npm or github, etc.

- Grant **_reader**, 	**_writer**, and **_replicator** permissions to the API key.

### Environment variables - development

You will need an  environment variable named `REACT_APP_COUCHDB` which is used within the project's redux **store.js** to establish synchronization between a local PouchDB database and CouchDB database in Cloudant.

  ```
  ...
  PouchDB.sync('fishing', process.env.REACT_APP_COUCHDB, {
  	live: true,
  	retry: true
  })
  ...
  ```

- For local development, copy the **.env-sample** file as **.env**.  

> The **.env** file will _not_ be deployed to production or synced with github. See **.gitingore**.  **IMPORTANT**  Make a note of the password and keep it safe. For security reasons, do not deploy the password to npm or github, etc.

- Within the **.env** file, replace the following placeholders with your Cloudant information:
  - `cloudant-api-key`
  - `cloudant-password`
  - `your-cloudant-user-name`


### Environment variables - production - Storing a secret with Now.

 Use the `now` cli to store a secret named `couchdb` into now.  See [Environment Variables and Secrets](https://zeit.co/blog/environment-variables-secrets).  The value for the `couchdb` secret should be the same value as your `REACT_APP_COUCHDB` environment value within the **.env** file.  

  Example:
```
$ now secrets add couchdb "https://{cloudant-api-key}:{cloudant-password}@{your-cloudant-user-name}.cloudant.com/fishing"
```

### Starting the application

- Using terminal, ensure you are in the **pro-log-fishing** directory.

  ```
  $ npm start
  ```

  The application should start on localhost:3000.

## Building your application

- Locate the **package.json** from within the **pro-log-fishing/_build_** folder.
- Copy the the file to a temp directory.  This file will be overwritten when we `npm run build` in the next step
- Using terminal, ensure you are in the **pro-log-fishing** and build the application:

  ```
  $ cd pro-log-fishing
  $ npm run build
  ```

- Copy **package.json** back to **build** folder.

- Install dependencies:

  ```
  $ cd build
  $ yarn (or npm install)
  ```

- From the **build** folder,  test the build, locally.

  ```
  npm run start
  ```

## Deploying to production using [Now](https://zeit.co/)

- From the **build** folder, deploy.  Populate the `process.env.REACT_APP_COUCHDB` production environment variable with our secret using the `-e` option:

  ```
  $ now -e REACT_APP_COUCHDB=@couchdb
  ```
  See [Environment Variables and Secrets](https://zeit.co/blog/environment-variables-secrets).

  Make note of the ugly url that was generated by now.  By default, Now will copy it to your clipboard.  

- Verify deployed application by browsing to the ugly url.

- Alias the ugly url to something a little more user-friendly.  See [Aliases](https://zeit.co/docs/features/aliases).

  ```
  $ now alias set <paste ugly url here> pro-log-fishing
  ```

- Now browse to **https://pro-log-fishing.now.sh**.
